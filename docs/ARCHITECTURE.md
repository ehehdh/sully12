# ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

> Politi-Logì˜ ì‹œìŠ¤í…œ ì„¤ê³„ ë° ì•„í‚¤í…ì²˜ ë¬¸ì„œ

## ğŸ“Š í˜„ì¬ ìƒíƒœ ìš”ì•½

| í•­ëª© | í˜„ì¬ | ìƒíƒœ |
|------|------|------|
| **ì•„í‚¤í…ì²˜** | ë‹¨ì¼ Next.js ì•± | âœ… |
| **ìƒíƒœ ê´€ë¦¬** | Zustand + Supabase | âœ… |
| **AI í”„ë¡¬í”„íŠ¸** | ì™¸ë¶€ ì„¤ì • íŒŒì¼ | âœ… |
| **ì¸ì¦** | ì¹´ì¹´ì˜¤ OAuth | âœ… |
| **ë§ˆì´í˜ì´ì§€** | í†µê³„/ì „ì  ì‹œìŠ¤í…œ | âœ… |
| **í† ë¡  ê¸°ë¡** | ìë™ ì•„ì¹´ì´ë¸Œ | âœ… |
| **ê´€ë¦¬ì ì¸ì¦** | ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸ | âœ… |
| **ì‚¬ìš©ì ê´€ë¦¬** | ì—­í• /ì œì¬ ì‹œìŠ¤í…œ | âœ… |
| **ì‹ ê³  ì‹œìŠ¤í…œ** | ì‹ ê³  ì ‘ìˆ˜/ì²˜ë¦¬ | âœ… |

---

## ğŸ¯ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Client (Next.js)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Pages   â”‚  â”‚Componentsâ”‚  â”‚  Hooks   â”‚  â”‚  Store  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     API Routes                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  /auth   â”‚  â”‚ /debates â”‚  â”‚/realtime â”‚  â”‚ /users  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    External Services                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Supabase    â”‚   Groq API     â”‚    Kakao OAuth        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚PostgreSQL â”‚ â”‚ â”‚ Llama 3.1  â”‚ â”‚  â”‚ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸   â”‚  â”‚
â”‚  â”‚- rooms    â”‚ â”‚ â”‚- Analysis  â”‚ â”‚  â”‚ - ì‚¬ìš©ì ì¸ì¦   â”‚  â”‚
â”‚  â”‚- messages â”‚ â”‚ â”‚- Verdict   â”‚ â”‚  â”‚ - í”„ë¡œí•„ ì •ë³´   â”‚  â”‚
â”‚  â”‚- users    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚- records  â”‚ â”‚                â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ì½”ë“œ êµ¬ì¡°

```
src/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ page.tsx                  # í™ˆí˜ì´ì§€
â”‚   â”œâ”€â”€ login/                    # ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â”œâ”€â”€ mypage/                   # ë§ˆì´í˜ì´ì§€ ğŸ†•
â”‚   â”‚   â”œâ”€â”€ page.tsx              # í”„ë¡œí•„/í†µê³„
â”‚   â”‚   â””â”€â”€ history/              # í† ë¡  ê¸°ë¡
â”‚   â”œâ”€â”€ admin/                    # ê´€ë¦¬ì í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ì´ìŠˆ ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ debates/              # í† ë¡  ê¸°ë¡ ê´€ë¦¬ ğŸ†•
â”‚   â”œâ”€â”€ debate/[id]/              # í† ë¡ ë°© í˜ì´ì§€
â”‚   â”œâ”€â”€ lobby/                    # ë¡œë¹„
â”‚   â””â”€â”€ api/                      # API ë¼ìš°íŠ¸
â”‚       â”œâ”€â”€ auth/                 # ì¸ì¦ API ğŸ†•
â”‚       â”‚   â”œâ”€â”€ kakao/            # ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸
â”‚       â”‚   â”œâ”€â”€ me/               # í˜„ì¬ ì‚¬ìš©ì
â”‚       â”‚   â””â”€â”€ logout/           # ë¡œê·¸ì•„ì›ƒ
â”‚       â”œâ”€â”€ debates/              # í† ë¡  ê¸°ë¡ API ğŸ†•
â”‚       â”‚   â”œâ”€â”€ archive/          # ì•„ì¹´ì´ë¸Œ
â”‚       â”‚   â””â”€â”€ records/          # ê¸°ë¡ ì¡°íšŒ
â”‚       â”œâ”€â”€ users/                # ì‚¬ìš©ì API ğŸ†•
â”‚       â”‚   â””â”€â”€ me/
â”‚       â”‚       â”œâ”€â”€ stats/        # í†µê³„
â”‚       â”‚       â””â”€â”€ history/      # ì „ì 
â”‚       â”œâ”€â”€ rooms/                # ë°© ê´€ë ¨ API
â”‚       â”œâ”€â”€ realtime/             # ì‹¤ì‹œê°„ API
â”‚       â””â”€â”€ topics/               # ì£¼ì œ API
â”‚
â”œâ”€â”€ components/                   # UI ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ ui/                       # ê¸°ë³¸ UI (ë²„íŠ¼, ì¹´ë“œ ë“±)
â”‚   â”œâ”€â”€ auth/                     # ì¸ì¦ ì»´í¬ë„ŒíŠ¸ ğŸ†•
â”‚   â”‚   â”œâ”€â”€ KakaoLoginButton.tsx
â”‚   â”‚   â””â”€â”€ UserAuthButton.tsx
â”‚   â””â”€â”€ debate/                   # í† ë¡  ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚
â”œâ”€â”€ config/                       # ì„¤ì • íŒŒì¼
â”‚   â””â”€â”€ prompts/                  # AI í”„ë¡¬í”„íŠ¸
â”‚
â”œâ”€â”€ features/                     # ê¸°ëŠ¥ ëª¨ë“ˆ (ë¸”ë¡)
â”‚   â”œâ”€â”€ auth/                     # ì¸ì¦ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ admin/                    # ê´€ë¦¬ì ëª¨ë“ˆ
â”‚   â”œâ”€â”€ debate/                   # í† ë¡  í•µì‹¬ ëª¨ë“ˆ
â”‚   â””â”€â”€ ai-moderator/             # AI ì¤‘ì¬ì ëª¨ë“ˆ
â”‚
â””â”€â”€ lib/                          # ìœ í‹¸ë¦¬í‹°
    â”œâ”€â”€ supabase.ts               # Supabase í´ë¼ì´ì–¸íŠ¸
    â”œâ”€â”€ useAuth.tsx               # ì¸ì¦ í›… ğŸ†•
    â”œâ”€â”€ db.ts                     # DB í•¨ìˆ˜
    â””â”€â”€ debateStages.ts           # í† ë¡  ë‹¨ê³„ ì„¤ì •
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### í•µì‹¬ í…Œì´ë¸”

```sql
-- ì‚¬ìš©ì (ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸)
users (
  id, kakao_id, email, nickname, profile_image, role, created_at
)

-- í† ë¡  ê¸°ë¡ (ì•„ì¹´ì´ë¸Œ)
debate_records (
  id, topic_id, topic_title,
  pro_user_id, pro_user_name,
  con_user_id, con_user_name,
  winner, final_score_pro, final_score_con,
  verdict_summary, total_messages, duration_seconds,
  started_at, ended_at
)

-- í† ë¡  ë©”ì‹œì§€ ì•„ì¹´ì´ë¸Œ
debate_messages_archive (
  id, debate_record_id,
  role, content, sender_name, stage,
  original_created_at
)

-- ì‚¬ìš©ì í†µê³„
user_stats (
  user_id, total_debates, wins, losses, draws, win_rate,
  pro_debates, pro_wins, con_debates, con_wins,
  avg_score, highest_score, current_streak, best_win_streak
)

-- ì‹¤ì‹œê°„ ë°© (ì§„í–‰ ì¤‘ì¸ í† ë¡ )
rooms (...), participants (...), messages (...)

-- í† ë¡  ì£¼ì œ
issues (...)
```

---

## ğŸ” ì¸ì¦ ì‹œìŠ¤í…œ

### ì¹´ì¹´ì˜¤ OAuth íë¦„

```
1. ì‚¬ìš©ìê°€ "ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸" í´ë¦­
      â”‚
      â–¼
2. /api/auth/kakao â†’ ì¹´ì¹´ì˜¤ ì¸ì¦ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
      â”‚
      â–¼
3. ì¹´ì¹´ì˜¤ì—ì„œ ë¡œê·¸ì¸ í›„ ì½œë°±
      â”‚
      â–¼
4. /api/auth/kakao/callback
      â”œâ”€â”€ í† í° êµí™˜
      â”œâ”€â”€ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
      â”œâ”€â”€ Supabase users í…Œì´ë¸” upsert
      â””â”€â”€ ì„¸ì…˜ ì¿ í‚¤ ìƒì„±
      â”‚
      â–¼
5. í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ë¡œê·¸ì¸ ì™„ë£Œ)
```

### ì„¸ì…˜ ê´€ë¦¬

- **ì¿ í‚¤ ê¸°ë°˜**: `politi-log-session` (httpOnly, secure)
- **ë§Œë£Œ**: 7ì¼
- **í˜•ì‹**: Base64 ì¸ì½”ë”©ëœ JSON

---

## ğŸ”„ í† ë¡  ê¸°ë¡ íë¦„

```
1. í† ë¡  ì‹œì‘ (rooms í…Œì´ë¸”)
      â”‚
      â–¼
2. 12ë‹¨ê³„ í† ë¡  ì§„í–‰ (messages í…Œì´ë¸”)
      â”‚
      â–¼
3. ìµœì¢… íŒì • ìƒì„± (AI)
      â”‚
      â–¼
4. stage = 'ended' ì „í™˜
      â”‚
      â–¼
5. ìë™ ì•„ì¹´ì´ë¸Œ íŠ¸ë¦¬ê±°
      â”œâ”€â”€ debate_records ìƒì„±
      â”œâ”€â”€ debate_messages_archive ë³µì‚¬
      â””â”€â”€ user_stats ì—…ë°ì´íŠ¸
      â”‚
      â–¼
6. ë§ˆì´í˜ì´ì§€/ê´€ë¦¬ìì—ì„œ ì¡°íšŒ ê°€ëŠ¥
```

---

## ğŸ§© ê¸°ëŠ¥ ëª¨ë“ˆ ìƒíƒœ

| ëª¨ë“ˆ | ìƒíƒœ | ì„¤ëª… |
|------|------|------|
| `debate` | ğŸŸ¢ êµ¬í˜„ë¨ | í† ë¡  í•µì‹¬ ë¡œì§ |
| `ai-moderator` | ğŸŸ¢ êµ¬í˜„ë¨ | AI ë¶„ì„ ê¸°ëŠ¥ |
| `auth` | ğŸŸ¢ êµ¬í˜„ë¨ | ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ |
| `admin` | ğŸŸ¢ êµ¬í˜„ë¨ | ì´ìŠˆ/í† ë¡  ê´€ë¦¬ |
| `admin-auth` | ğŸŸ¢ êµ¬í˜„ë¨ | ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ |
| `user-management` | ğŸŸ¢ êµ¬í˜„ë¨ | ì‚¬ìš©ì ì—­í• /ì œì¬ ê´€ë¦¬ |
| `reports` | ğŸŸ¢ êµ¬í˜„ë¨ | ì‹ ê³  ì ‘ìˆ˜/ì²˜ë¦¬ |
| `user-stats` | ğŸŸ¢ êµ¬í˜„ë¨ | ì „ì /í†µê³„ ì‹œìŠ¤í…œ |

---

## ğŸ“‹ API ì—”ë“œí¬ì¸íŠ¸

### ì¸ì¦ (/api/auth)

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | /api/auth/kakao | ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹œì‘ |
| GET | /api/auth/kakao/callback | OAuth ì½œë°± |
| GET | /api/auth/me | í˜„ì¬ ì‚¬ìš©ì ì •ë³´ |
| POST | /api/auth/logout | ë¡œê·¸ì•„ì›ƒ |

### í† ë¡  ê¸°ë¡ (/api/debates)

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | /api/debates/archive | í† ë¡  ì•„ì¹´ì´ë¸Œ |
| GET | /api/debates/archive | ê¸°ë¡ ëª©ë¡ ì¡°íšŒ |
| GET | /api/debates/records/[id] | ê¸°ë¡ ìƒì„¸ ì¡°íšŒ |
| DELETE | /api/debates/records/[id] | ê¸°ë¡ ì‚­ì œ |

### ì‚¬ìš©ì (/api/users)

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | /api/users/me/stats | ë‚´ í†µê³„ |
| GET | /api/users/me/history | ë‚´ í† ë¡  ê¸°ë¡ |

### ê´€ë¦¬ì (/api/admin)

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | /api/admin/auth | ê´€ë¦¬ì ë¡œê·¸ì¸ |
| DELETE | /api/admin/auth | ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ |
| GET | /api/admin/users | ì‚¬ìš©ì ëª©ë¡ |
| GET | /api/admin/users/[id] | ì‚¬ìš©ì ìƒì„¸ |
| PATCH | /api/admin/users/[id] | ì—­í•  ë³€ê²½/ì œì¬ |
| GET | /api/admin/reports | ì‹ ê³  ëª©ë¡ |
| PATCH | /api/admin/reports | ì‹ ê³  ì²˜ë¦¬ |

### ì‹ ê³  (/api/reports)

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | /api/reports | ì‹ ê³  ì ‘ìˆ˜ |
| GET | /api/reports | ë‚´ ì‹ ê³  ì¡°íšŒ |

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### êµ¬í˜„ë¨

- âœ… ì¹´ì¹´ì˜¤ OAuth ì¸ì¦
- âœ… httpOnly ì„¸ì…˜ ì¿ í‚¤
- âœ… í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜ ë°©ì§€
- âœ… API í‚¤ ì„œë²„ ì‚¬ì´ë“œ ë³´ê´€
- âœ… ë³´í˜¸ëœ ë¼ìš°íŠ¸ (ë¡œê·¸ì¸ í•„ìˆ˜)
- âœ… **ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ (Middleware)**
- âœ… **ì‚¬ìš©ì ì œì¬ ì‹œìŠ¤í…œ (ì •ì§€/ì°¨ë‹¨)**
- âœ… **ì‹ ê³  ì‹œìŠ¤í…œ**

### ê³„íšë¨

- ğŸ“‹ Rate limiting
- ğŸ“‹ 2ë‹¨ê³„ ì¸ì¦ (OTP)

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

| ê¸°ìˆ  | ì„ íƒ ì´ìœ  |
|------|----------|
| **Next.js 14** | SSR, App Router, API Routes í†µí•© |
| **Supabase** | PostgreSQL + ì‹¤ì‹œê°„ + ì¸ì¦ ì˜¬ì¸ì› |
| **Groq API** | ë¹ ë¥¸ LLM ì¶”ë¡ , Llama 3.1 ì§€ì› |
| **Kakao OAuth** | í•œêµ­ ì‚¬ìš©ì ì¹œí™”ì  ë¡œê·¸ì¸ |
| **Zustand** | ê°„ë‹¨í•œ ìƒíƒœ ê´€ë¦¬, React ì¹œí™”ì  |
| **Tailwind CSS** | ë¹ ë¥¸ ìŠ¤íƒ€ì¼ë§, ì¼ê´€ëœ ë””ìì¸ ì‹œìŠ¤í…œ |
| **Framer Motion** | ë¶€ë“œëŸ¬ìš´ UI ì• ë‹ˆë©”ì´ì…˜ |
| **Vercel** | Next.js ìµœì í™” í˜¸ìŠ¤íŒ… |

---

*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2024.12.26*
